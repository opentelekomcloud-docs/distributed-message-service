:original_name: kafka-ug-180524001.html

.. _kafka-ug-180524001:

Configuring a Kafka Alarm Rule
==============================

This section describes the alarm rules of some metrics and how to configure them. In actual services, you are advised to configure alarm rules for metrics based on the following alarm policies:

.. table:: **Table 1** Alarm policies and handling of Kafka instances

   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | Metric ID               | Metric                    | Monitored Object | Alarm Policy                                                                                                                                                                                                      | Description                                                                                        | Handling Suggestion                                                                                                                                                                                                                                                                                                        |
   +=========================+===========================+==================+===================================================================================================================================================================================================================+====================================================================================================+============================================================================================================================================================================================================================================================================================================================+
   | broker_disk_usage       | Disk Capacity Usage       | Broker           | Alarm threshold: original value > 80%                                                                                                                                                                             | Disk usage of the Kafka VM                                                                         | Modify the instance **storage space**. For details, see :ref:`Modifying Instance Specifications <kafka-ug-181221001>`.                                                                                                                                                                                                     |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 1                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: critical                                                                                                                                                                                          |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | broker_cpu_core_load    | Average Load per CPU Core | Broker           | Alarm threshold: original value > 2                                                                                                                                                                               | Average load of each CPU core of the Kafka VM.                                                     | Check whether the metric has been approaching or exceeding the alarm threshold for a long time. If yes, modify the **number of brokers**. For details, see :ref:`Modifying Instance Specifications <kafka-ug-181221001>`.                                                                                                  |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 3                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: major                                                                                                                                                                                             |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | broker_memory_usage     | Memory Usage              | Broker           | Alarm threshold: original value > 90%                                                                                                                                                                             | Memory usage of the Kafka VM.                                                                      | Modify the **number of brokers**. For details, see :ref:`Modifying Instance Specifications <kafka-ug-181221001>`.                                                                                                                                                                                                          |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 3                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: critical                                                                                                                                                                                          |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | current_partitions      | Partitions                | Instance         | Alarm threshold: original value > 90% of the maximum allowed number of partitions. The partition limit varies depending on instance specifications. For details, see :ref:`Specifications <kafka-specification>`. | Number of used partitions in the instance.                                                         | If new topics are required, modify the number of brokers, or split the service to multiple instances. For details about how to modify the number of brokers, see :ref:`Modifying Instance Specifications <kafka-ug-181221001>`.                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 1                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: major                                                                                                                                                                                             |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | broker_cpu_usage        | CPU Usage                 | Broker           | Alarm threshold: original value > 90%                                                                                                                                                                             | CPU usage of the Kafka VM.                                                                         | Check whether the metric has been approaching or exceeding the alarm threshold for a long time. If yes, modify the **number of brokers**. For details, see :ref:`Modifying Instance Specifications <kafka-ug-181221001>`.                                                                                                  |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 3                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: major                                                                                                                                                                                             |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | group_msgs              | Accumulated Messages      | Instance         | Alarm threshold: original value > 90% of the upper limit. The upper limit is customized.                                                                                                                          | Total number of accumulated messages in all consumer groups of the instance                        | Delete idle consumer groups, if any. You can also accelerate message retrieval, for example, by increasing the number of consumers.                                                                                                                                                                                        |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 1                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: major                                                                                                                                                                                             |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | topic_messages_remained | Topic Available Messages  | Consumer group   | Alarm threshold: original value > 90% of the upper limit. The upper limit is customized.                                                                                                                          | Number of remaining messages that can be retrieved from the specified topic in the consumer group. | Check whether the consumer code logic is correct, for example, by checking whether the consumer stops consuming messages due to an exception. You can also accelerate message retrieval, for example, by adding topic consumers. Ensure that the number of partitions is greater than or equal to the number of consumers. |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Number of consecutive periods: 1                                                                                                                                                                                  |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  |                                                                                                                                                                                                                   |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   |                         |                           |                  | Alarm severity: major                                                                                                                                                                                             |                                                                                                    |                                                                                                                                                                                                                                                                                                                            |
   +-------------------------+---------------------------+------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Procedure
---------

#. Log in to the console.

#. Click |image1| in the upper left corner to select a region.

   .. note::

      Select the region where your Kafka instance is located.

#. Click **Service List** and choose **Application** > **Distributed Message Service**. The Kafka instance list is displayed.

#. Go to the monitoring page in either of the following ways:

   -  Click **View Metric** in the row containing the desired Kafka instance.
   -  Click the desired Kafka instance to go to the instance details page. Choose **Monitoring** in the navigation pane.

#. Hover the mouse pointer over a metric and click |image2| to create an alarm rule for the metric. The **Create Alarm Rule** page is displayed.

#. Specify the alarm details.

   For more information about creating alarm rules, see `Creating an Alarm Rule <https://docs.otc.t-systems.com/en-us/usermanual/ces/ces_01_0073.html>`__.

   a. Set the alarm name and description.

   b. Set the alarm policy.

      As shown in the following figure, if the original disk capacity usage is equal to or higher than 85% for three consecutive periods, an alarm is generated. If the alarm is not handled on time, an alarm notification is sent.


      .. figure:: /_static/images/en-us_image_0000001757257336.png
         :alt: **Figure 1** Setting the alarm policy and alarm severity

         **Figure 1** Setting the alarm policy and alarm severity

   c. Set the alarm notification configurations.

      If you enable **Alarm Notification**, specify **Notification Window**, **Notification Object**, and **Trigger Condition**.

   d. Click **Create**.

.. |image1| image:: /_static/images/en-us_image_0143929918.png
.. |image2| image:: /_static/images/en-us_image_0000001160616010.png
